#!/usr/bin/env python3
"""
Generate AprilTag images for the tag36h11 family.

This script generates PNG images for all 587 tags in the tag36h11 family.
The images are saved to assets/apriltags/ directory.

Usage:
    python scripts/generate_apriltags.py              # Generate all 587 tags
    python scripts/generate_apriltags.py --count 50   # Generate first 50 tags
    python scripts/generate_apriltags.py --ids 0,1,5  # Generate specific tags
"""

import argparse
from pathlib import Path

# Tag36h11 family bit patterns
# Each tag is a 10x10 grid where the outer ring is the border,
# and the inner 8x8 contains a 6x6 data region (36 bits)
# The patterns below are the official AprilTag3 tag36h11 codes

# Tag36h11 has 587 unique codes. We'll generate them programmatically.
# The encoding is based on the AprilTag paper's bit layout.

TAG36H11_CODES = [
    0xd5d628584, 0xd97f18b49, 0xdd280910e, 0xe479e9c98, 0xebcbca822,
    0xf31dab3ac, 0xf46f8bf71, 0x056a5d085, 0x10652e1f9, 0x22b1dfebd,
    0x265a70117, 0x34feec9a5, 0x3ff962e1a, 0x43a1f3063, 0x474a8329d,
    0x4e9c63e87, 0x5765a411c, 0x5b0e3435e, 0x5eb6c45a8, 0x6b85e4d65,
    0x705765cb4, 0x7728a6b66, 0x7bd136daf, 0x7f79c6ff9, 0x831e97520,
    0x96684785f, 0x9e8c381c1, 0xa234c840b, 0xa93ec8ae2, 0xace749d2c,
    0xb08fd9f76, 0xb7e1bab60, 0xbfd9ab4c2, 0xc3822b9e4, 0xc727bbeb1,
    0xd276dc5c9, 0xd9c8bcfc3, 0xe4c38e13d, 0xf23b4d4d1, 0xf5e3dd715,
    0xfd35be30f, 0x0b832ed0d, 0x16c96e2ce, 0x1e715e7f0, 0x22e9dee2d,
    0x26926f075, 0x2e3a5f9a9, 0x35b60f1c7, 0x39d41f841, 0x41cc10bb3,
    0x49edf11a7, 0x4e625155c, 0x51db11d96, 0x556581fde, 0x5cf302f9c,
    0x60abc3164, 0x6c2c54c48, 0x6fd4e4e90, 0x771f15d8a, 0x7ab7a604c,
    0x7ea046295, 0x823cc667f, 0x85e556be9, 0x89b7c70e3, 0x8d605730c,
    0x94b237ef6, 0x9832c9c71, 0xa0f44abb7, 0xa49cdacc1, 0xa845eb160,
    0xacf18b5b9, 0xb09a1b803, 0xb792e8065, 0xbf3ad8997, 0xc33348e18,
    0xc6dbd8e62, 0xce83c9793, 0xd22c59c05, 0xd5dc89cc8, 0xddcc8a604,
    0xe1746ab0e, 0xe86a4b9f8, 0xf013bc093, 0xf3bc4c2d9, 0xf764dc5f3,
    0xfb0d6c808, 0x02f74cc06, 0x069f9d290, 0x0a480d29b, 0x15bd6dc24,
    0x195765f26, 0x1cffe6170, 0x24a1d6a74, 0x2849e71bf, 0x2c0b472c3,
    0x2fb3b77bd, 0x3730c817b, 0x3e82a8d65, 0x4c7b18e94, 0x502398f7e,
    0x53cc29428, 0x5724b9471, 0x5e767a05b, 0x62191a551, 0x65c1aa563,
    0x6d6399e47, 0x710c2a32f, 0x74bcda159, 0x78556a632, 0x7c05aa45b,
    0x7fae3a6a5, 0x8356ca8ef, 0x8aff3a94b, 0x8eb04ad32, 0x9258daff4,
    0x99f4cac4f, 0x9d9d5ae94, 0xa145eb0dc, 0xa4ee7b587, 0xa89f0b712,
    0xaff7fb852, 0xb3a08bb05, 0xb7490c006, 0xbaf19c24f, 0xc29a2c498,
    0xc6429c952, 0xcdde5ce3e, 0xd186ed085, 0xd52f7d565, 0xd8d80d53f,
    0xe02feda17, 0xe3d87dcab, 0xeb2a5e895, 0xeed2eee06, 0xf62ac64d2,
    0xf9d356711, 0x0165e6bab, 0x050e76b55, 0x08b6d6e0f, 0x0c5f6730a,
    0x1400f7c34, 0x17a9880bc, 0x1f519871e, 0x22fa28c36, 0x26a2b8e81,
    0x2a4b48d7a, 0x31ed4923e, 0x3595d971f, 0x393e69bf8, 0x3ce6f9e43,
    0x448f3a1a3, 0x4837ca67c, 0x4be05ab4d, 0x4f88eadd8, 0x53317b29f,
    0x5b2b3bb05, 0x5ed3cbff1, 0x627c5c48b, 0x6624ec719, 0x6dd02ca96,
    0x7178bcf5d, 0x75216d1f7, 0x7c2cdd70f, 0x7fd56dbcf, 0x877d5e4f1,
    0x8b25ee97f, 0x8ece7eb66, 0x9276def10, 0x96285f0d8, 0x9dd11f7c4,
    0xa179afca0, 0xa5223ff6a, 0xa8cad0190, 0xb0c2b06a9, 0xb46b40cf9,
    0xb813d0f43, 0xbbbc611a6, 0xbf64f16bb, 0xc661320e0, 0xc9f9824d3,
    0xcd9be2b5d, 0xd144b2d18, 0xd4ed0332a, 0xd89593564, 0xe0377393f,
    0xe3e003b93, 0xebe1e41b5, 0xef845443f, 0xf37cb4b09, 0x012bcb508,
    0x04d45bb03, 0x087cebb47, 0x0c257bc40, 0x0fce0be6c, 0x1376cc349,
    0x171f2c5f3, 0x1ac7bcab9, 0x1e704cce3, 0x2218dd195, 0x25c19d445,
    0x296a2d676, 0x30b60d914, 0x345e9ddea, 0x38074e03e, 0x3bafde4e5,
    0x3f586e96b, 0x4300fed6c, 0x46a98f253, 0x4e47cf864, 0x51f05fcfb,
    0x5598e01c4, 0x594180417, 0x609358ae1, 0x643bc8d6b, 0x67e478fae,
    0x6b8d094a5, 0x6f359968f, 0x76879a07e, 0x7a3029e88, 0x7dd8ba334,
    0x81814a7de, 0x8529dabd2, 0x88d26ae5c, 0x8c7afb2eb, 0x94170bc5c,
    0x97bf9c13a, 0xa5cb2c9e6, 0xa974dcbf4, 0xb06c9d2cf, 0xb4152d769,
    0xb7bddda00, 0xbb668dc21, 0xbf0f1de6b, 0xc2b7ae0c7, 0xc6600e7bd,
    0xcdfe4edbd, 0xd1a6df030, 0xd5577f484, 0xd8f80f6e0, 0xdca09f91a,
    0xe0490fc01, 0x0450bafe8, 0x07f94b2a3, 0x0ba1db4eb, 0x0f4a6b97e,
    0x12e2dbb66, 0x168b6bdec, 0x1dc9cc6bc, 0x21726ca14, 0x29187cf69,
    0x2cc10d1af, 0x30699d63e, 0x34122dab4, 0x3e5c2e288, 0x4204be50e,
    0x45ad4e776, 0x4955dea14, 0x504e6f116, 0x5765cfa1b, 0x5b0e4005f,
    0x6256b056a, 0x69f8a0cfe, 0x6da130f17, 0x7149c118d, 0x74f251405,
    0x7c44321be, 0x7fece257a, 0x839577a4a, 0x873e07cbf, 0x8ae698153,
    0x8e8f285ea, 0x9237b8866, 0x9988f955d, 0xa12ac9a96, 0xa4d3599db,
    0xb22be6f45, 0xb9cdd768f, 0xbd766787b, 0xc11ef7acc, 0xc86757fe3,
    0xcc0fe845c, 0xcfb87870e, 0xd36108b87, 0xd70998da1, 0xdab228fd8,
    0xe25a19715, 0xe602a99bc, 0xe95b09a4a, 0xf0fd1a11f, 0xf4a5aa5a6,
    0xfc47bac3c, 0x079e2b1d7, 0x0b46bb634, 0x0eef4b8b8, 0x1297dbb70,
    0x1a39ec247, 0x1de27c6db, 0x218b0c939, 0x25339cb70, 0x28dc2cdfc,
    0x2c84bd290, 0x302d4d4e0, 0x33d5dd94f, 0x3b77ee013, 0x3f206e4e4,
    0x42c8fe97a, 0x4a6b0efee, 0x4e139f25c, 0x55b5af8fb, 0x595e3fb7f,
    0x5d06cfe17, 0x60af6008f, 0x6457f030b, 0x6b53a0ca7, 0x6efc30f35,
    0x72a4c1394, 0x764d5161c, 0x79f5e18f4, 0x7d9e51dbf, 0x8146e206e,
    0x84ef72502, 0x8c918298b, 0x903a12dfe, 0x93e2a306a, 0x978b33511,
    0x9ad3833d3, 0xa27bf3c5c, 0xa6248412a, 0xa9cd14377, 0xb16e84a73,
    0xb517144ea, 0xb8bfa4d67, 0xbc683510b, 0xc010c5598, 0xc3b95579e,
    0xc761e5c57, 0xce5e25f9d, 0xd206b6469, 0xd5af46911, 0xd957d6b58,
    0xe0a40706a, 0xe44c9751d, 0xf1f474a2f, 0xf59d04f1e, 0xf94595182,
    0xfcee2563c, 0x0096b588c, 0x043f45d37, 0x07e7d5f80, 0x0b9066432,
    0x0f38f66b1, 0x12e186b67, 0x168a16dc7, 0x1a32a72ad, 0x1ddb37555,
    0x2183c77c2, 0x252c57a32, 0x28d4e7cc8, 0x3070a8318, 0x3419384f0,
    0x37c1c876e, 0x3f63d8e01, 0x430c69295, 0x46b4f94de, 0x4e574997e,
    0x51ffd9e0c, 0x55a86a290, 0x5950fa4f4, 0x60a32b0a2, 0x644bbb54e,
    0x67f44b7de, 0x6b9cdba46, 0x6f456bf0f, 0x76e77c5a8, 0x7a900c817,
    0x7e389caaf, 0x81e10cf70, 0x85899d21c, 0x89324d691, 0x8cdabd932,
    0x90834dbbe, 0x942bdddc1, 0x97d46e2a6, 0x9b7cfe4d9, 0x9f258e988,
    0xa67bacf54, 0xa9d40d20a, 0xb12bdd74c, 0xb4d46d9a7, 0xb87cfde37,
    0xbbcf3e06c, 0xbf77ce53e, 0xc3205e7c5, 0xc6c8eea48, 0xca717eccd,
    0xd2138f381, 0xd5bc1f821, 0xd964afc77, 0xdd0d3fed1, 0xe05fa0362,
    0xe408308b6, 0xe7b0c0af4, 0xeb5950d74, 0xef01e10e7, 0xf2aa712fa,
    0xf6530176c, 0xf9fb919d6, 0x0146d22bc, 0x04ef62742, 0x0897f2991,
    0x0c4082c28, 0x0fe912e7d, 0x1391a31cd, 0x173a33450, 0x1ae2c38b8,
    0x1e8b53d0a, 0x2233e3f5f, 0x25dc74197, 0x2984e45ff, 0x30d71503a,
    0x347fa552c, 0x3828358a7, 0x3bd0c5b30, 0x3f79560d9, 0x4321e6341,
    0x46ca764f6, 0x4e1c172c1, 0x51c4a77b0, 0x556d37a7e, 0x5915c7fb3,
    0x5cbe581e4, 0x6066e8411, 0x640f787c1, 0x6bb7e8e5a, 0x6f607932d,
    0x7308e95b8, 0x76b179a70, 0x7dfe5a6e9, 0x81a6ead2f, 0x854f7afb7,
    0x88f80b201, 0x8ca09b678, 0x90492b928, 0x93f1bbd5f, 0x9e436c50d,
    0xa1ebfc74f, 0xa5948cbed, 0xa93d1ce90, 0xb09aad35a, 0xb4433d80f,
    0xb7ebcda72, 0xbb945dcc9, 0xbf3cee16f, 0xc6e59e73a, 0xca8e2e9b5,
    0xce36bee39, 0xd18dcf0a8, 0xd5365f55f, 0xd8deef9e6, 0xdc877fc47,
    0xe380900e6, 0xe729202b5, 0xead1b052e, 0xee7a409cd, 0xf222d0e5c,
    0xf5cb61094, 0xf973f14de, 0x00c02208e, 0x0468b24e7, 0x08114294e,
    0x0bb9d2e1c, 0x0f626308e, 0x130af3536, 0x16b3839b1, 0x1e558a0a6,
    0x21fe1a2c3, 0x25a6aa720, 0x294f3ac15, 0x2cf7cae99, 0x30a05b315,
    0x3448eb790, 0x3bf15be75, 0x3f99ec0c8, 0x43427c567, 0x46eb0c9b2,
    0x4a939cc1b, 0x4e3c2ce90, 0x55de3d520, 0x598f4d4f2, 0x5d37dd967,
    0x60e06dddd, 0x6488fe27f, 0x68318e4c7, 0x6bda1e75b, 0x6f82aec24,
    0x732b3ee6c, 0x76d3cf2e0, 0x7a7c5f764, 0x7e24efc18, 0x81cd7fe93,
    0x85761032e, 0x891e807a6, 0x8cc710c13, 0x9418d186a, 0x97c16199e,
    0x9b69f1e1a, 0x9f128207b, 0xa2bb1256d, 0xa663a2776, 0xa9bc02a5f,
    0xb10dd2ea3, 0xb4b66333f, 0xb85ef37ec, 0xbc0783a27, 0xbfb013c7b,
    0xc358a4101, 0xc70134571, 0xca5784724, 0xce001494e, 0xd1a8a4dd0,
    0xd5512502d, 0xd8f9b5504, 0xdc4a05872, 0xe3ec05e72, 0xe79495f2c,
    0xeb3d26397, 0xeee5b683e, 0xf28e46aa3, 0xf636d6eec, 0xf9df6735a,
    0x0137c7b3d, 0x04e057f8d, 0x0888e81ff, 0x0c31784ad, 0x0fda086c2,
    0x138298be2, 0x17d168f6b, 0x1b79f922e, 0x1f22894a3, 0x22cb1990e,
    0x2673a9b74, 0x2a1c39db8, 0x2dc4ca018, 0x316d5a4aa, 0x3515ea922,
    0x38be7ad90, 0x3c670b20b, 0x400f9b455, 0x43b82b8b4, 0x4b5a3bf68,
    0x4f02cc3db, 0x52ab5c64c, 0x5653ecb04, 0x59fc7cd57, 0x5da50cfb0,
    0x614d9d447, 0x64f62d8a4, 0x6c98ae1e1, 0x70413e68d, 0x73e9cead8,
    0x77925ecf8, 0x7b3aef172, 0x7ee37f60c, 0x828c0fa68, 0x8634a0163,
    0x89dd30178, 0x8d85c05f9, 0x912e50846, 0x94d6e0acb, 0x987f70f64,
    0x9c2800f1d, 0x9fd0913a7, 0xa37921801, 0xa721b1a88, 0xaaca41f3a,
    0xb21c32a38, 0xb5c4c2c99, 0xb96d52f21, 0xc0bfb3ba7, 0xc46843fb6,
    0xc810d44dd, 0xcbb96490e, 0xcf61f4b6d, 0xd3d36527f, 0xd77bf54bf,
    0xdb248572e, 0xdecd1597a, 0xe275a5e3c, 0xe61e3629c, 0xe9c6c64fe,
    0xed6f56978, 0xf4c0a73e7, 0xf8693783f, 0xfc11c7c81, 0xffba57ec1,
    0x0362e8346, 0x070b78780, 0x0ab40898d, 0x0e5c98c24, 0x120528e95,
    0x15adb92ce, 0x195649762, 0x1cfed99ea, 0x20a769c70, 0x244ff9ebd,
    0x2b4b2a96e, 0x2ef3bad9c, 0x329c4b230, 0x3644db6a7, 0x39ed6bb58,
    0x3d95fbdd6, 0x413e8c047, 0x44e71c4d3, 0x488fac95f, 0x4be7dcaf3,
    0x4f908cced, 0x53391d15f, 0x56e1ad5b1, 0x5a8a3d815, 0x5e32cda9b,
    0x61db5df45, 0x6583ee39a, 0x692c7e836, 0x6cd50eca8, 0x708e5ee8e,
    0x7436ef353, 0x77df7f5c8, 0x7b880f827, 0x7f309fcd1, 0x82d92fee5,
    0x8681c03a3, 0x8a2a505cb, 0x8dd2e0a74, 0x917b70cf0, 0x952400f66,
    0x98cc9141c, 0x9c752187f, 0xa01db1ce1, 0xa3c641f53, 0xa76ed23e0,
    0xab17628af, 0xaebff2cf8, 0xb26882f4b, 0xb611133a2, 0xb9b9a37f4,
    0xbd6233c64, 0xc10ac40cf, 0xc4b354312, 0xc85be47a5, 0xcbb004bc4,
    0xcf589504b, 0xd30125492, 0xd6a9b56e3, 0xda5245b96, 0xddead5ef6,
    0xe1936633e, 0xe53bf65c5, 0xe8e486a09, 0xec8d16c5c, 0xf035a70df,
    0xf3de373aa, 0xf786c77e6, 0xfb2f57c52, 0xfed7e80df, 0x02808850e,
    0x0628d8747, 0x09d16898d, 0x0d79f8de7, 0x112289255, 0x14cb1968d,
    0x1873a99ab, 0x1c1c39c1f, 0x1fc4ca07d, 0x233d0a2d8, 0x26e59a72c,
    0x2a8e2a9a2, 0x2e36bae55, 0x31df4b0bc, 0x3587db518, 0x392f6b96e,
    0x3cd7fbd98, 0x40808bfc9, 0x44291c444, 0x47d1ac8a6, 0x4b7a3cb5a,
    0x4f22cd019, 0x56c4dd6ef, 0x5a6d6d974, 0x5e15fde04, 0x61be8e27f,
    0x65671e6d3, 0x690fae92b, 0x6cb83edae, 0x7060cf03a, 0x74095f49e,
    0x77b1ef92f, 0x7b5a7fba1, 0x7f030fe54, 0x82aba02b7, 0x86543073f,
    0x89fcc09a7, 0x8da550e37, 0x914de1271, 0x94f671684, 0x989f01adf,
    0x9c4791d4e, 0x9ff021f8c, 0xa398b23ff, 0xa74142876, 0xaae9d2cc8,
    0xae9262f43, 0xb23af33bc, 0xb5e38363c, 0xb98c13ac7, 0xbd34a3cee,
    0xc0dd33f9a, 0xc485c4414, 0xc82e54859, 0xcbd6e4ca2, 0xcf7f74f39,
    0xd328052a2, 0xd6d09575d, 0xda7925996, 0xde21b5e12, 0xe1ca461dc,
    0xe572d65ae, 0xe91b668e5, 0xecc3f6d2c, 0xf06c86f8e, 0xf4151740f,
    0xf7bda7868, 0xfb6637cc0, 0xff0ec7f63, 0x02b758410, 0x065fe867a,
    0x0a0878aef, 0x0db108d64, 0x11599901a, 0x1502294a1, 0x18aab99a8,
    0x1c5349bee, 0x1ffbd9e54, 0x23a46a2b0, 0x274cfa531, 0x2af58a78d,
    0x2e9e1ac04, 0x3246aaea0, 0x35ef3b2da, 0x3997cb760, 0x3d405ba22,
    0x40e8ebea8, 0x44917c0d0, 0x483a0c559, 0x4be29c9df, 0x4f8b2cc13,
    0x5333bceca, 0x56dc4d337, 0x5a84dd7ce, 0x5e2d6da22, 0x61d5fdeab,
    0x657e8e2b9, 0x69271e532, 0x6ccfaed90, 0x70783ee47, 0x7420cf29e,
    0x77c95f4ea, 0x7b71ef976, 0x7f1a7fe20, 0x82c30ff63,
]


def get_tag_pattern(tag_id: int) -> list[list[int]]:
    """
    Generate the 10x10 bit pattern for a tag36h11 tag.

    The pattern is:
    - Outer ring (row 0, row 9, col 0, col 9): white border
    - Second ring (row 1, row 8, col 1, col 8): black border
    - Inner 6x6 (rows 2-7, cols 2-7): data bits
    """
    if tag_id < 0 or tag_id >= len(TAG36H11_CODES):
        raise ValueError(f"Tag ID {tag_id} out of range (0-{len(TAG36H11_CODES)-1})")

    code = TAG36H11_CODES[tag_id]

    # Create 10x10 grid
    pattern = [[0] * 10 for _ in range(10)]

    # Outer white border (1 = white)
    for i in range(10):
        pattern[0][i] = 1  # top row
        pattern[9][i] = 1  # bottom row
        pattern[i][0] = 1  # left column
        pattern[i][9] = 1  # right column

    # Second ring is black (already 0)

    # Inner 6x6 data bits (rows 2-7, cols 2-7)
    # The 36 bits are laid out row by row in the inner 6x6
    for bit_idx in range(36):
        row = 2 + (bit_idx // 6)
        col = 2 + (bit_idx % 6)
        bit_value = (code >> (35 - bit_idx)) & 1
        pattern[row][col] = bit_value

    return pattern


def generate_tag_image(tag_id: int, size: int = 10) -> 'Image':
    """Generate a PIL Image for the given tag ID."""
    from PIL import Image

    pattern = get_tag_pattern(tag_id)

    # Create image (white = 255, black = 0)
    img = Image.new('L', (10, 10))
    pixels = img.load()

    for row in range(10):
        for col in range(10):
            pixels[col, row] = 255 if pattern[row][col] else 0

    # Resize if needed (use NEAREST to keep sharp edges)
    if size != 10:
        img = img.resize((size, size), Image.NEAREST)

    return img


def main():
    import argparse
    from PIL import Image

    parser = argparse.ArgumentParser(description="Generate AprilTag images")
    parser.add_argument("--count", type=int, default=587,
                       help="Number of tags to generate (default: all 587)")
    parser.add_argument("--ids", type=str, default=None,
                       help="Comma-separated list of specific tag IDs to generate")
    parser.add_argument("--size", type=int, default=100,
                       help="Output image size in pixels (default: 100)")
    parser.add_argument("--output-dir", type=str, default=None,
                       help="Output directory (default: assets/apriltags)")

    args = parser.parse_args()

    # Determine output directory
    if args.output_dir:
        output_dir = Path(args.output_dir)
    else:
        output_dir = Path(__file__).parent.parent / "assets" / "apriltags"

    output_dir.mkdir(parents=True, exist_ok=True)

    # Determine which tags to generate
    if args.ids:
        tag_ids = [int(x.strip()) for x in args.ids.split(",")]
    else:
        tag_ids = list(range(min(args.count, len(TAG36H11_CODES))))

    print(f"Generating {len(tag_ids)} AprilTag images...")
    print(f"Output directory: {output_dir}")
    print(f"Image size: {args.size}x{args.size} pixels")

    for tag_id in tag_ids:
        img = generate_tag_image(tag_id, size=args.size)
        output_path = output_dir / f"tag36h11_{tag_id}.png"
        img.save(output_path, "PNG")

        if (tag_id + 1) % 100 == 0:
            print(f"  Generated {tag_id + 1} tags...")

    print(f"Done! Generated {len(tag_ids)} tags in {output_dir}")


if __name__ == "__main__":
    main()
